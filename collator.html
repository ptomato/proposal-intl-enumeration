<emu-clause id="collator-objects">
  <h1>Collator Objects</h1>

  <emu-clause id="sec-the-intl-collator-constructor">
    <h1>The Intl.Collator Constructor</h1>
    <p>...</p>

    <emu-clause id="sec-initializecollator" aoid="InitializeCollator">
      <h1>InitializeCollator ( _collator_, _locales_, _options_ )</h1>

      <p>
        The abstract operation InitializeCollator accepts the arguments _collator_ (which must be an object), _locales_, and _options_. It initializes _collator_ as a Collator object. The following steps are taken:
      </p>
      <p>
        The following algorithm refers to the `type` nonterminal from <a href="https://www.unicode.org/reports/tr35/#Unicode_locale_identifier">UTS 35's Unicode Locale Identifier grammar</a>.
      </p>
      <emu-alg>
        1. Let _requestedLocales_ be ? CanonicalizeLocaleList(_locales_).
        1. Set _options_ to ? CoerceOptionsToObject(_options_).
        1. Let _usage_ be ? GetOption(_options_, *"usage"*, ~string~, &laquo; *"sort"*, *"search"* &raquo;, *"sort"*).
        1. Set _collator_.[[Usage]] to _usage_.
        1. If _usage_ is *"sort"*, then
          1. Let _localeData_ be %Collator%.[[SortLocaleData]].
        1. Else,
          1. Let _localeData_ be %Collator%.[[SearchLocaleData]].
        1. Let _opt_ be a new Record.
        1. Let _matcher_ be ? GetOption(_options_, *"localeMatcher"*, ~string~, &laquo; *"lookup"*, *"best fit"* &raquo;, *"best fit"*).
        1. Set _opt_.[[localeMatcher]] to _matcher_.
        1. Let _collation_ be ? GetOption(_options_, *"collation"*, ~string~, ~empty~, *undefined*).
        1. If _collation_ is not *undefined*, then
          1. If _collation_ does not match the Unicode Locale Identifier `type` nonterminal, throw a *RangeError* exception.
        1. Set _opt_.[[co]] to _collation_.
        1. <ins>NOTE: _collation_ is not canonicalized here for historical reasons.</ins>
        1. Let _numeric_ be ? GetOption(_options_, *"numeric"*, ~boolean~, ~empty~, *undefined*).
        1. If _numeric_ is not *undefined*, then
          1. Let _numeric_ be ! ToString(_numeric_).
        1. Set _opt_.[[kn]] to _numeric_.
        1. Let _caseFirst_ be ? GetOption(_options_, *"caseFirst"*, ~string~, &laquo; *"upper"*, *"lower"*, *"false"* &raquo;, *undefined*).
        1. Set _opt_.[[kf]] to _caseFirst_.
        1. Let _relevantExtensionKeys_ be %Collator%.[[RelevantExtensionKeys]].
        1. Let _r_ be ResolveLocale(%Collator%.[[AvailableLocales]], _requestedLocales_, _opt_, _relevantExtensionKeys_, _localeData_).
        1. Set _collator_.[[Locale]] to _r_.[[locale]].
        1. Let _collation_ be _r_.[[co]].
        1. If _collation_ is *null*, let _collation_ be *"default"*.
        1. Set _collator_.[[Collation]] to _collation_.
        1. If _relevantExtensionKeys_ contains *"kn"*, then
          1. Set _collator_.[[Numeric]] to SameValue(_r_.[[kn]], *"true"*).
        1. If _relevantExtensionKeys_ contains *"kf"*, then
          1. Set _collator_.[[CaseFirst]] to _r_.[[kf]].
        1. Let _sensitivity_ be ? GetOption(_options_, *"sensitivity"*, ~string~, &laquo; *"base"*, *"accent"*, *"case"*, *"variant"* &raquo;, *undefined*).
        1. If _sensitivity_ is *undefined*, then
          1. If _usage_ is *"sort"*, then
            1. Let _sensitivity_ be *"variant"*.
          1. Else,
            1. Let _dataLocale_ be _r_.[[dataLocale]].
            1. Let _dataLocaleData_ be _localeData_.[[&lt;_dataLocale_&gt;]].
            1. Let _sensitivity_ be _dataLocaleData_.[[sensitivity]].
        1. Set _collator_.[[Sensitivity]] to _sensitivity_.
        1. Let _ignorePunctuation_ be ? GetOption(_options_, *"ignorePunctuation"*, ~boolean~, ~empty~, *false*).
        1. Set _collator_.[[IgnorePunctuation]] to _ignorePunctuation_.
        1. Return _collator_.
      </emu-alg>
    </emu-clause>
  </emu-clause>
</emu-clause>
