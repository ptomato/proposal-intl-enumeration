<emu-clause id="intl-displaynames-objects">
  <h1>DisplayNames Objects</h1>

  <p>...</p>

  <emu-clause id="sec-intl-displaynames-abstracts">
    <h1>Abstract Operations for DisplayNames Objects</h1>

    <emu-clause id="sec-canonicalcodefordisplaynames" aoid="CanonicalCodeForDisplayNames">
      <h1>CanonicalCodeForDisplayNames ( _type_, _code_ )</h1>
      <p>
        The CanonicalCodeForDisplayNames abstract operation takes arguments _type_ (a String) and _code_ (a String). It verifies that the _code_ argument represents a well-formed code according to the _type_ argument and returns the case-regularized form of the _code_. The algorithm refers to <a href="https://www.unicode.org/reports/tr35/#Identifiers">UTS 35's Unicode Language and Locale Identifiers grammar</a>. The following steps are taken:
      </p>
      <emu-alg>
        1. If _type_ is *"language"*, then
          1. If _code_ does not match the `unicode_language_id` production, throw a *RangeError* exception.
          1. If ! IsStructurallyValidLanguageTag(_code_) is *false*, throw a *RangeError* exception.
          1. Return ! CanonicalizeUnicodeLocaleId(_code_).
        1. If _type_ is *"region"*, then
          1. If _code_ does not match the `unicode_region_subtag` production, throw a *RangeError* exception.
          1. Return the ASCII-uppercase of _code_.
        1. If _type_ is *"script"*, then
          1. If _code_ does not match the `unicode_script_subtag` production, throw a *RangeError* exception.
          1. Assert: The length of _code_ is 4, and every code unit of _code_ represents an ASCII letter (0x0041 through 0x005A and 0x0061 through 0x007A, both inclusive).
          1. Let _first_ be the ASCII-uppercase of the substring of _code_ from 0 to 1.
          1. Let _rest_ be the ASCII-lowercase of the substring of _code_ from 1.
          1. Return the string-concatenation of _first_ and _rest_.
        1. If _type_ is *"calendar"*, then
          1. If _code_ does not match the Unicode Locale Identifier `type` nonterminal, throw a *RangeError* exception.
          1. If _code_ uses any of the backwards compatibility syntax described in <a href="https://unicode.org/reports/tr35/#BCP_47_Conformance">Unicode Technical Standard #35 LDML ยง 3.3 BCP 47 Conformance</a>, throw a *RangeError* exception.
          1. Return the ASCII-lowercase of _code_.
          1. <ins>NOTE: _code_ is not canonicalized here for historical reasons.</ins>
        1. If _type_ is *"dateTimeField"*, then
          1. If the result of IsValidDateTimeFieldCode(_code_) is *false*, throw a *RangeError* exception.
          1. Return _code_.
        1. Assert: _type_ is *"currency"*.
        1. If ! IsWellFormedCurrencyCode(_code_) is *false*, throw a *RangeError* exception.
        1. Return <del>the ASCII-uppercase of _code_</del><ins>CanonicalizeCurrency(_code_)</ins>.
      </emu-alg>
    </emu-clause>
  </emu-clause>
</emu-clause>
